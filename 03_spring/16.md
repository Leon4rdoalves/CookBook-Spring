<h1>Projeto 02 - Blog Pessoal - Spring Security - Ecossistema da Seguran√ßa</h1>

O que veremos por aqui:

1. O Ecossistema da Seguran√ßa
2. A Classe UserDetailsImpl
3. A Classe UserDetailsServiceImpl
4. A Classe BasicSecurityConfig

Antes de finalizarmos o Ecossistema do Usu√°rio, vamos compreender e implementar o **Ecossistema da Seguran√ßa**, porqu√™ utilizaremos alguns M√©todos deste ecossistema na implementa√ß√£o das **Classes UsuarioService e UsuarioController**.

<h2>1.  Ecossistema da Seguran√ßa</h2>

<div align="center"><img src="https://i.imgur.com/0pHAkL3.png" title="source: imgur.com" /></div>

No Diagrama de Classes acima, √© poss√≠vel visualizar por completo o ecossistema da Seguran√ßa, que representa uma das principais implementa√ß√µes da Spring Security. Nesta implementa√ß√£o √© poss√≠vel realizar a autentica√ß√£o do usu√°rio a partir de um Banco de dados. Para isso √© necess√°rio enviar as informa√ß√µes necess√°rias (usuario e senha) para que o Spring Security valide a permiss√£o do usu√°rio no sistema. 

O ecossistema de seguran√ßa √© composto por 3 Classes:

- **BasicSecurityConfig**

- **UserDetailsService**

- **UserDetailsImpl** 

A cor de cada uma das Classes no Diagrama de Classes acima representa o pacote onde cada uma deve ser implementada, segundo informa√ß√µes da legenda. Para este Diagrama de Classes, repare que a Classe Model do **Usuario** e a Interface **Repository do Usuario** j√° foram criadas no Ecossistema do Usu√°rio. Para melhor compreens√£o das rela√ß√µes entre as Classes veja uma breve defini√ß√£o sobre as rela√ß√µes entre os Objetos:

<div align="center"><img src="https://i.imgur.com/IGtJRbG.jpg" title="source: imgur.com" width="50%"/></div>

| Rela√ß√£o           | Descri√ß√£o                                                    |
| ----------------- | ------------------------------------------------------------ |
| **Depend√™ncia**   | Classe A pode ser afetada por mudan√ßas na Classe B;          |
| **Associa√ß√£o**    | Objeto A sabe sobre objeto B. Classe A depende de B;         |
| **Agrega√ß√£o**     | Objeto A sabe sobre objeto B, e consiste de B. Classe A depende de B; |
| **Composi√ß√£o**    | Objeto A sabe sobre objeto B, consiste de B, e gerencia o ciclo de vida de B. Classe A depende de B; |
| **Implementa√ß√£o** | Classe A define M√©todos declarados na interface B. objetos de A podem ser tratados como B. Classe A depende de B; |
| **Heran√ßa**       | Classe A herda a interface e implementa√ß√£o da Classe B mas pode estende-la. Objetos de A podem ser tratados como B. Classe A depende de B. |

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="120px"/> | <div align="left">**DICA:** *Caso voc√™ tenha d√∫vidas sobre o entendimento do Diagrama de Classes , <a href="uml.md">clique aqui</a> e veja um breve Resumo sobre Diagrama Classes e suas rela√ß√µes.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Ap√≥s compreender o Diagrama de Classes acima e aprender um pouco sobre UML, vamos implementar as nossas 3  Classes.

<h2>üë£ Passo 01 - Criar o Pacote Security</h2>

Primeiro vamos criar a camada de seguran√ßa, ou seja, o Pacote Security, onde as  Classes ser√£o implementadas:

1. No lado esquerdo superior, na Guia **Package explorer**, clique com o bot√£o direito do mouse sobre a Package **com.generation.blogpessoal**, na Source Folder **src/main/java** e clique na op√ß√£o  **New ü°™ Package**.

2. Na janela **New Java Package**, no item **Name**, acrescente no final do nome da Package **.security**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/pw8NoI1.png" title="source: imgur.com" /></div>

3. Clique no bot√£o **Finish** para concluir.

<h2>üë£ Passo 02 - Criar a Classe UserDetailsImpl na Camada Security</h2>

A Classe **UserDetailsImpl** implementa a Interface **UserDetails**, que tem como principal funcionalidade fornecer as informa√ß√µes b√°sicas do usu√°rio para o Spring Security (Usu√°rio, Senha, Direitos de acesso e as Restri√ß√µes da conta). 

Ap√≥s a autentica√ß√£o (login) do usu√°rio no sistema, a Classe de Servi√ßo **UserDetailsServiceImpl** instanciar√° um novo Objeto da Classe **UserDetailsImpl** com os respectivos Atributos preenchidos com os dados do usu√°rio autenticado (usuario e senha). Este Objeto tamb√©m conter√° todos os M√©todos herdados da Interface UserDetails, que consultam os Direitos de acesso (roles) e implementam as restri√ß√µes da conta do usu√°rio.

1. Clique com o bot√£o direito do mouse sobre o **Pacote Security** (**com.generation.blogpessoal.security**), na Source Folder Principal (**src/main/java**), e clique na op√ß√£o **New ü°™ Class**
2. Na janela **New Java Class**, no item **Name**, digite o nome da Classe (**UserDetailsImpl**), e na sequ√™ncia clique no bot√£o **Finish** para concluir.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="250px"/> | <div align="left"> **ATEN√á√ÉO:** *Por se tratar de uma Implementa√ß√£o de uma Interface (UserDetails), todos os M√©todos da Interface devem ser implementados e o nome da Classe deve obrigatoriamente conter o sufixo Impl (Implements), indicando que a Classe est√° Implementando a Interface.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Vejamos abaixo a implementa√ß√£o da Classe UserDeatilsImpl:

```java
package com.generation.blogpessoal.security;

import java.util.Collection;
import java.util.List;

import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;

import com.generation.blogpessoal.model.Usuario;

public class UserDetailsImpl implements UserDetails{

private static final long serialVersionUID =1L;
	
	private String userName;
	private String password;
	
	private List<GrantedAuthority> authorities;
	
	public UserDetailsImpl (Usuario user){
		this.userName = user.getUsuario();
		this.password = user.getSenha();
	}
	
	public UserDetailsImpl (){ }
	
	@Override
	public Collection<? extends GrantedAuthority> getAuthorities() {
	
		return authorities;
	}

	@Override
	public String getPassword() {
	
		return password;
	}

	@Override
	public String getUsername() {
		
		return userName;
	}

	@Override
	public boolean isAccountNonExpired() {
		
		return true;
	}

	@Override
	public boolean isAccountNonLocked() {
		
		return true;
	}

	@Override
	public boolean isCredentialsNonExpired() {
		
		return true;
	}

    @Override
	public boolean isEnabled() {
		
		return true;
	}

}
```

<h3>M√©todos da Interface com as restri√ß√µes da conta:</h3>

| M√©todo                        | Descri√ß√£o                                                    |
| ----------------------------- | ------------------------------------------------------------ |
| **isAccountNonExpired()**     | Indica se a conta do usu√°rio expirou. Uma conta expirada n√£o pode ser autenticada (return false). |
| **isAccountNonLocked()**      | Indica se o usu√°rio est√° bloqueado ou desbloqueado. Um usu√°rio bloqueado n√£o pode ser autenticado (return false). |
| **isCredentialsNonExpired()** | Indica se as credenciais do usu√°rio (senha) expiraram. Senha expirada impede a autentica√ß√£o (return false). |
| **isEnabled()**               | Indica se o usu√°rio est√° habilitado ou desabilitado. Um usu√°rio desabilitado n√£o pode ser autenticado (return false). |

Para concluir, n√£o esque√ßa de Salvar o c√≥digo (**File ü°™ Save All**).

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="350px"/> |<div align="left"> ALERTA DE BSM: Mantenha a Aten√ß√£o aos Detalhes, √© necess√°rio ter um construtor adaptado para receber Atributos que ser√£o utilizados para logar no sistema. Os Atributos em quest√£o s√£o usu√°rio e senha, mas poderia ser tamb√©m e-mail e senha. Tudo ir√° depender de como a model de Usuario esta elaborada.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="350px"/> | <div align="left"> **ATEN√á√ÉO:** *Observe que o M√©todo getAuthorities(), que retorna a lista com os direitos de acesso do usu√°rio, sempre retornar√° uma List vazia, porqu√™ este Atributo n√£o pode ser Nulo. Com o objetivo de simplificar a nossa implementa√ß√£o, todo o Usu√°rio autenticado ter√° todos os direitos de acesso sobre a aplica√ß√£o. * </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/FEcFPvm.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/UserDetails.html" target="_blank"><b>Documenta√ß√£o: <i>Interface UserDetails</i></b></a>

<div align="left"><img src="https://i.imgur.com/FEcFPvm.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/GrantedAuthority.html"><b>Documenta√ß√£o: <i>M√©todo GrantedAuthority</i></b></a>

<h2>üë£ Passo 03 - Criar a Implementa√ß√£o da Classe UserDetailsServiceImpl</h2>

A Classe **UserDetailsServiceImpl** √© uma implementa√ß√£o da Interface **UserDetailsService**, respons√°vel por validar a exist√™ncia de um usu√°rio no sistema atrav√©s do Banco de dados e retornar um Objeto da Classe **UserDetailsImpl** (implementada no passo anterior), com os dados encontrados no Banco de dados. 

A Interface **UserDetailsService** permite autenticar um usu√°rio baseando-se na sua exist√™ncia no Banco de dados (em nosso caso na tabela tb_usuarios). Vale lembrar que para isso √© necess√°rio que ao persistir o usu√°rio no Banco de dados, **a senha obrigatoriamente deve estar criptografada** (Veremos na implementa√ß√£o da Classe **UsuarioService**), utilizando uma biblioteca de criptografia do Spring Security e **o usuario (e-mail) deve ser √∫nico no sistema**, ou seja, n√£o podem existir 2 usu√°rios com o mesmo e-mail. 

1. Clique com o bot√£o direito do mouse sobre o **Pacote Security** (**com.generation.blogpessoal.security**), na Source Folder Principal (**src/main/java**), e clique na op√ß√£o **New ü°™ Class**
2. Na janela **New Java Class**, no item **Name**, digite o nome da Classe (**UserDetailsServiceImpl**), e na sequ√™ncia clique no bot√£o **Finish** para concluir.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="250px"/> | <div align="left"> **ATEN√á√ÉO:** *Por se tratar de uma Implementa√ß√£o de uma Interface (UserDetailsService), todos os M√©todos da Interface devem ser implementados e o nome da Classe deve obrigatoriamente conter o sufixo Impl (Implements), indicando que a Classe est√° Implementando a Interface.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Vejamos abaixo a implementa√ß√£o da Classe:


```java
package com.generation.blogpessoal.security;

import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;
import org.springframework.web.server.ResponseStatusException;

import com.generation.blogpessoal.model.Usuario;
import com.generation.blogpessoal.repository.UsuarioRepository;

@Service
public class UserDetailsServiceImpl implements UserDetailsService {
	
	@Autowired
	private UsuarioRepository usuarioRepository;

	@Override
	public UserDetails loadUserByUsername(String userName) throws UsernameNotFoundException {

		Optional<Usuario> usuario = usuarioRepository.findByUsuario(userName);

		if (usuario.isPresent())
			return new UserDetailsImpl(usuario.get());
		else
			throw new ResponseStatusException(HttpStatus.FORBIDDEN);
	}
}

```

O M√©todo **loadUserByUsername(String username)** recebe o usu√°rio atrav√©s da tela de login do sistema e utiliza a Query Method **findByUsuario(String usuario)**, implementada na Interface **UsuarioRepository**, para checar se o usu√°rio digitado est√° persistido no Banco de dados. 

Caso esteja persistido (**isPresent()**), ele executa o construtor da Classe **UserDetailsImpl**, passando o Objeto usuario como par√¢metro. Observe que foi utilizado M√©todo **get()** no Objeto usuario por se tratar de um Optional. 

Caso o usu√°rio n√£o exista, ser√° devolvido o **HTTP Status 403 - FORBIDDEN** (Acesso Proibido - voc√™ est√° tentando alcan√ßar um endere√ßo ou um site ao qual est√° proibido de acessar).

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="150px"/> | <div align="left"> ALERTA DE BSM: Mantenha a Aten√ß√£o aos Detalhes, ao criar esta Classe de Servi√ßo. N√£o esque√ßa de colocar a anota√ß√£o @Service. </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/FEcFPvm.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/UserDetailsService.html" target="_blank"><b>Documenta√ß√£o: <i>Interface UserDetailsService</i></b></a>
<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status/403" target="_blank"><b>Documenta√ß√£o: HTTP Status Code 403 - Forbidden</b></a></div>

<h2>üë£ Passo 04 - Criar a Classe BasicSecurityConfig</h2>

A Classe **BasicSecurityConfig** √© utilizada para sobrescrever a configura√ß√£o padr√£o da **Spring Security**. A Classe BasicSecurityConfig possui 2 anota√ß√µes: 

- **@Configuration:** indica que a  Classe √© do tipo configura√ß√£o, ou seja, define uma Classe como fonte de  defini√ß√µes de Beans, al√©m de ser uma das anota√ß√µes essenciais ao utilizar uma configura√ß√£o baseada em Java.
- **@EnableWebSecurity:** habilita a seguran√ßa de forma Global (toda a aplica√ß√£o) e sobrescreve os M√©todos que ir√£o redefinir as regras de Seguran√ßa da sua aplica√ß√£o.

> **Bean:** No Spring, os objetos que formam a espinha dorsal da sua aplica√ß√£o e que s√£o gerenciados pelo Spring s√£o chamados de **Beans**. Um Bean √© um objeto que √© instanciado, montado e gerenciado pelo Spring. 
>
> Existem diversas formas de se criar Beans no Spring. Voc√™ pode criar Classes anotadas com **@Configuration** ou **@Service** para serem gerenciadas pelo Spring, assim como pode usar a anota√ß√£o **@Bean** em um M√©todo, e transformar a inst√¢ncia retornada pelo M√©todo em um Objeto gerenciado pelo Spring (seja de uma Classe pr√≥pria ou de terceiros).
>
> Estas Classes, que na vis√£o do Spring s√£o os Beans, para voc√™ nada mais s√£o do que Classes que voc√™ ir√° escrever as regras de funcionamento da sua aplica√ß√£o, que poder√£o ser utilizadas em qualquer Classe, diferente da **Inje√ß√£o de Depend√™ncia** criada pela anota√ß√£o **@Autowired**, que s√≥ permite o uso dentro da Classe em que foi criada.

1. Clique com o bot√£o direito do mouse sobre o **Pacote Security** (**com.generation.blogpessoal.security**), na Source Folder Principal (**src/main/java**), e clique na op√ß√£o **New ü°™ Class**
2. Na janela **New Java Class**, no item **Name**, digite o nome da Classe (**BasicSecurityConfig**), e na sequ√™ncia clique no bot√£o **Finish** para concluir.

```java
package com.generation.blogpessoal.security;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@EnableWebSecurity
public class BasicSecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {

        http
            .sessionManagement()
            .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            .and().csrf().disable()
            .cors();

        http
            .authorizeHttpRequests((auth) -> auth
                .antMatchers("/usuarios/logar").permitAll()
                .antMatchers("/usuarios/cadastrar").permitAll()
                .antMatchers(HttpMethod.OPTIONS).permitAll()
                .anyRequest().authenticated())
            .httpBasic();

        return http.build();

    }

}
```

O M√©todo ***passwordEncoder()*** , indica ao Spring Security que a aplica√ß√£o est√° baseada em um modelo de criptografia. Para esta aplica√ß√£o estamos utilizando o modelo **BCryptPasswordEncoder()**, que se trata de um algoritmo de criptografia do tipo hash. Vale ressaltar que esta criptografia est√° sendo esperada para analisar a senha que estamos guardando no Banco de dados.

> **Hash** √© um algoritmo que transforma dados de comprimento vari√°vel em dados de comprimento fixo codificados.


| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="120px"/> | <div align="left">Dica: No primeiro link abaixo voc√™ pode conhecer mais sobre o algoritmo BCrypt e no segundo link voc√™ pode testar a codifica√ß√£o e a decodifica√ß√£o de Strings geradas atrav√©s do algoritmo BCrypt.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="25px"/> <a href="https://medium.com/reprogramabr/uma-breve-introdu%C3%A7%C3%A3o-sobre-bcrypt-f2fad91a7420" target="_blank"><b>Artigo: <i>Uma breve introdu√ß√£o sobre BCrypt</i></b></a>

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="25px"/> <a href="https://bcrypt-generator.com" target="_blank"><b>Site: <i>Codificador BCrypt</i></b></a>

<div align="left"><img src="https://i.imgur.com/FEcFPvm.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/password/PasswordEncoder.html" target="_blank"><b>Documenta√ß√£o: <i>Interface PasswordEncoder</i></b></a>

<div align="left"><img src="https://i.imgur.com/FEcFPvm.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/bcrypt/BCryptPasswordEncoder.html" target="_blank"><b>Documenta√ß√£o: <i>Classe BCryptPasswordEncoder</i></b></a>

O M√©todo ***authenticationManager(AuthenticationConfiguration authenticationConfiguration)***, informa ao spring que a configura√ß√£o de autentica√ß√£o ser√° redefinida em sua implementa√ß√£o. Este M√©todo utiliza o M√©todo ***authenticationConfiguration.getAuthenticationManager()*** para procurar uma implementa√ß√£o da Interface **UserDetailsService** e utiliz√°-la para identificar se o usu√°rio √© v√°lido ou n√£o. Em nosso projeto Blog Pessoal, ser√° utilizada a Classe **UserDetailsServiceImpl**, que valida o usu√°rio no Banco de dados.

<div align="left"><img src="https://i.imgur.com/FEcFPvm.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/authentication/AuthenticationManager.html" target="_blank"><b>Documenta√ß√£o: <i>AuthenticationManager</i></b></a>

<div align="left"><img src="https://i.imgur.com/FEcFPvm.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/authentication/configuration/AuthenticationConfiguration.html" target="_blank"><b>Documenta√ß√£o: <i>AuthenticationConfiguration</i></b></a>

O M√©todo ***SecurityFilterChain filterChain(HttpSecurity http)***, estamos informando ao Spring que a configura√ß√£o  padr√£o da Spring Security ser√° substitu√≠da por uma nova configura√ß√£o. Nesta configura√ß√£o iremos customizar a autentica√ß√£o da aplica√ß√£o. 

Em nosso projeto Blog Pessoal, customizamos a nossa configura√ß√£o em 2 partes:

**Parte 01 - Configura√ß√µes essenciais**

**Classe HttpSecurity**: Permite configurar a seguran√ßa baseada na Web para solicita√ß√µes http espec√≠ficas. Por padr√£o, ser√° aplicado a todas as requisi√ß√µes que forem recebidas, mas pode ser restringido para apenas alguns endpoints.

**.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)**: Define que o nosso sistema n√£o guardar√° sess√µes para o cliente. Quando o cliente faz uma requisi√ß√£o HTTP, ele inclui todas as informa√ß√µes necess√°rias para o servidor atender √† requisi√ß√£o e a mesma √© finalizada com a resposta do servidor. O servidor nunca depender√° de informa√ß√µes de requisi√ß√µes anteriores para processar uma nova requisi√ß√£o. 

**.csrf().disable()**: Desabilita a prote√ß√£o que vem ativa contra ataques do tipo **CSRF (Cross-Site-Request-Forgery)**, que seria uma intercepta√ß√£o dos dados de autentica√ß√£o antes da requisi√ß√£o chegar ao servidor. Esta configura√ß√£o foi desabilitada porqu√™ o Spring Security fica procurando por um *par√¢metro oculto adicional* em **qualquer** requisi√ß√£o do tipo **POST / PUT / DELETE**, chamado **Token CSRF**. Como ele n√£o vai encontrar, todas as requisi√ß√µes diferentes de **GET** seriam bloqueadas.

**.cors()**: Libera o acesso de outras origens, desta forma nossa aplica√ß√£o poder√° ser acessada de outros dom√≠nios, ou seja, de outros endere√ßos, al√©m do endere√ßo onde a aplica√ß√£o est√° hospedada.

**Exemplo 1 - CORS habilitado:**

<div align="center"><img src="https://i.imgur.com/GYBEXtM.png?1" title="source: imgur.com" /></div>

**Exemplo 2 - CORS Desabilitado:**
<div align="center"><img src="https://i.imgur.com/xnQRLBf.png?1" title="source: imgur.com" /></div>

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ATEN√á√ÉO:** *Nos exemplos acima, observe que o front-end e o back-end, embora estejam hospedados no mesmo servidor (Heroku), os Dom√≠nios s√£o diferentes (frontend.herokuapp.com e backend.herokuapp.com), exigindo a habilita√ß√£o do CORS* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Parte 02 - Configura√ß√µes espec√≠ficas:**

Nesta segunda parte estamos utilizando uma Express√£o Lambda (***.authorizeHttpRequests((auth) -> auth)***) para definirmos as configura√ß√µes espec√≠ficas da aplica√ß√£o. Essa Express√£o Lambda √© chamada de **Lambda DSL (Domain Specific Language -  Linguagem de Dom√≠nio Espec√≠fico)**, ou seja, √© uma Express√£o Lambda explicitamente adaptada para um uso espec√≠fico (Spring Security), com o objetivo de reduzir a verbosidade do c√≥digo, tornando-o mais limpo.

**.authorizeHttpRequests((auth) -> auth)**: Atrav√©s desta Express√£o Lambda podemos definir quais endpoints poder√£o acessar o sistema sem precisar de autentica√ß√£o. O Objeto **auth** recebe o endere√ßo (URI) da requisi√ß√£o e checa se o endpoint necessita ou n√£o de autentica√ß√£o.

**.antMatchers("/usuarios/logar").permitAll() e .antMatchers("/usuarios/cadastrar").permitAll()**: Define os endere√ßos (URI) dos endpoints que estar√£o acess√≠veis sem autentica√ß√£o. No projeto Blog Pessoal foi definido que apenas os endpoints **logar e cadastrar** ser√£o livres de autentica√ß√£o. 

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="250px"/> | <div align="left"> **ATEN√á√ÉO:** *Os endpoints cadastrar e logar foram liberados porqu√™ caso contr√°rio ningu√©m conseguir√° acessar a aplica√ß√£o.* Os endere√ßos dos endpoints: /usuarios/logar e /usuarios/cadastrar devem estar obrigatoriamente definidos na implementa√ß√£o da Classe UsuarioController.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**.antMatchers(HttpMethod.OPTIONS).permitAll()**: O par√¢metro **HttpMethod.OPTIONS** permite que o cliente (front-end), possa descobrir quais s√£o as op√ß√µes permitidas e/ou obrigat√≥rias no cabe√ßalho da requisi√ß√£o. Se o par√¢metro **HttpMethod.OPTIONS** n√£o for liberado, a aplica√ß√£o n√£o receber√° o **Basic Token** atrav√©s do cabe√ßalho da requisi√ß√£o (Header), impedindo a aplica√ß√£o de responder as requisi√ß√µes protegidas.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ATEN√á√ÉO:** *Liberar o par√¢metro HttpMethod.OPTIONS de autentica√ß√£o √© essencial para o correto funcionamento do aplica√ß√£o na nuvem, em especial na integra√ß√£o com o front-end. Sem essa configura√ß√£o as requisi√ß√µes do front-end n√£o ser√£o autorizadas.*</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**.anyRequest().authenticated():** Informa ao sistema que todos os endpoints que n√£o estiverem especificados na lista acima, a autentica√ß√£o ser√° obrigat√≥ria.

**.httpBasic()**: Informa ao sistema que o servidor ir√° receber requisi√ß√µes que devem ter o esquema HTTP Basic de autentica√ß√£o. Ao abrir a sua aplica√ß√£o no navegador da Internet, ao inv√©s de abrir o formul√°rio que foi exibido ao habilitar a Spring Security, ser√° aberta a janela abaixo:

 <div align="center"><img src="https://i.imgur.com/mBRxYd8.png" title="source: imgur.com" width="50%"/></div>

**return http.build()**: Cria e instancia o Objeto http com as configura√ß√µes implementadas.

<div align="left"><img src="https://i.imgur.com/FEcFPvm.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html" target="_blank"><b>Documenta√ß√£o: <i>HttpSecurity</i></b></a>

<div align="left"><img src="https://i.imgur.com/FEcFPvm.png" title="source: imgur.com" width="25px"/> <a href="https://spring.io/blog/2019/11/21/spring-security-lambda-dsl" target="_blank"><b>Documenta√ß√£o: <i>Express√µes Lambda DSL</i></b></a>
<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Authentication" target="_blank"><b>Documenta√ß√£o: HTTP Basic Authentication</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status/401" target="_blank"><b>Documenta√ß√£o: HTTP Status Code 401 - Unauthorized</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/CORS" target="_blank"><b>Documenta√ß√£o: CORS</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://reflectoring.io/complete-guide-to-csrf/" target="_blank"><b>Artigo: Complete Guide to CSRF/XSRF (Cross-Site Request Forgery)</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="30px"/> <a href="https://github.com/conteudoGeneration/backend_blog_pessoal/tree/12-blog_pessoal_security_02" target="_blank"><b>C√≥digo fonte: Camada Security</b></a>

<br /><br />	

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
